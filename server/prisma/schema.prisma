generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id                   Int                @id @default(autoincrement())
  email                String             @unique
  passwordHash         String
  role                 String
  createdAt            DateTime           @default(now())
  doctorProfile        Doctor?
  nurseProfile         Nurse?
  patientProfile       Patient?
  reviewedApplications StaffApplication[]
}

model Department {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  doctors Doctor[]
}

model Doctor {
  id             Int            @id @default(autoincrement())
  fullName       String
  specialization String?
  departmentId   Int
  userId         Int            @unique
  appointments   Appointment[]
  department     Department     @relation(fields: [departmentId], references: [id])
  user           User           @relation(fields: [userId], references: [id], onUpdate: NoAction)
  prescriptions  Prescription[]
}

model Nurse {
  id       Int    @id @default(autoincrement())
  fullName String
  userId   Int    @unique
  user     User   @relation(fields: [userId], references: [id], onUpdate: NoAction)
}

model Patient {
  id            Int            @id @default(autoincrement())
  fullName      String
  dob           DateTime?
  phone         String?

  // âœ… ADD THESE NEW FIELDS
  sex           String
  age           Int
  address       String
  bloodGroup    String

  userId        Int            @unique
  admissions    Admission[]
  appointments  Appointment[]
  user          User           @relation(fields: [userId], references: [id], onUpdate: NoAction)
  prescriptions Prescription[]
}

model Appointment {
  id        Int      @id @default(autoincrement())
  dateTime  DateTime
  status    String   @default("Scheduled")
  doctorId  Int
  patientId Int
  doctor    Doctor   @relation(fields: [doctorId], references: [id], onUpdate: NoAction)
  patient   Patient  @relation(fields: [patientId], references: [id], onUpdate: NoAction)
}

model Admission {
  id            Int       @id @default(autoincrement())
  admitDate     DateTime  @default(now())
  dischargeDate DateTime?
  status        String    @default("Admitted")
  diagnosis     String?
  patientId     Int
  patient       Patient   @relation(fields: [patientId], references: [id], onUpdate: NoAction)
}

model Prescription {
  id         Int      @id @default(autoincrement())
  date       DateTime @default(now())
  medication String
  notes      String?
  doctorId   Int
  patientId  Int
  doctor     Doctor   @relation(fields: [doctorId], references: [id], onUpdate: NoAction)
  patient    Patient  @relation(fields: [patientId], references: [id], onUpdate: NoAction)
}

model StaffApplication {
  id                    Int      @id @default(autoincrement())
  fullName              String
  email                 String
  roleAppliedFor        String
  status                String   @default("PENDING")
  appliedAt             DateTime @default(now())
  reviewedByAdminUserId Int?
  reviewedByAdmin       User?    @relation(fields: [reviewedByAdminUserId], references: [id], onDelete: NoAction, onUpdate: NoAction)
}
